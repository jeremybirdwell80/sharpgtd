<?xml version="1.0" encoding="utf-8"?>

<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>

  <PropertyGroup>
    <Major>0</Major>
    <Minor>1</Minor>
    <Build>0</Build>
    <Revision>0</Revision>
  </PropertyGroup>
	<PropertyGroup>
      <OutputPath>Releases</OutputPath>
   </PropertyGroup>
  <ItemGroup>
    <DefaultExclude Include="**\_svn\**" />
    <DefaultExclude Include="**\bin\**" />
    <DefaultExclude Include="**\obj\**" />
    <DefaultExclude Include="**\Release\**" />
    <DefaultExclude Include="**\Debug\**" />
    <DefaultExclude Include="**\Test\**" />
    <DefaultExclude Include="**\TestResults\**" />
    <DefaultExclude Include="**\doc\**" />
    <DefaultExclude Include="**\www\**" />
    <DefaultExclude Include="**\*.user" />
    <DefaultExclude Include="**\*.suo" />
    <DefaultExclude Include="**\*.zip" />
    <DefaultExclude Include="**\*.txt" />	
  </ItemGroup>
  <ItemGroup>
	<ReleaseExclude Include="**\obj\**" />
	<DefaultExclude Include="**\*.user" />
    <DefaultExclude Include="**\*.suo" />
  </ItemGroup>
  <!--<ItemGroup>
    <ZipFiles Include="**\$(OutputPath)\**\*.*" Exclude="@(DefaultExclude)"   />
  </ItemGroup>-->
	<!--<ItemGroup>
		<FilesToCopy 
		Exclude="*\obj\;**\$(OutputPath)\*" 
		Include="**\*.cs;**\*.xaml;**\*.csproj;**\*.resx"
        />
	</ItemGroup>-->

  
	<Target Name="GetSource" DependsOnTargets="Clean">
		<CreateItem 
		Include="**\*.cs;**\*.xaml;**\*.csproj;**\*.resx;**\*.sln;**\*.xml;**\*.accessor"
		Exclude="*\obj\;**\Releases\**;**\bin\**" >
			<Output TaskParameter="Include" ItemName="FilesToCopy"/>
		</CreateItem>
      <MakeDir Directories= "$(OutputPath)"/>
      <Copy SourceFiles="@(FilesToCopy)"
            DestinationFiles="@(FilesToCopy->'$(OutputPath)\%(RecursiveDir)\%(Filename)%(Extension)')"
            ContinueOnError="true"/>
	</Target>
  <Target Name="Version" DependsOnTargets="GetSource">
    <SvnVersion LocalPath="$(MSBuildProjectDirectory)">
      <Output TaskParameter="Revision" PropertyName="Revision" />
    </SvnVersion>

     <Message Text="Version: $(Major).$(Minor).$(Build).$(Revision)"/>
    <AssemblyInfo CodeLanguage="CS" 
      OutputFile="$(OutputPath)\net.toodledo\Properties\AssemblyInfo.cs"
      AssemblyTitle="Toodledo.net"
      AssemblyDescription="Collection MSBuild Tasks"
      AssemblyCompany="http://msbuildtasks.tigris.org/"
      AssemblyProduct="MSBuild.Community.Tasks"
      AssemblyCopyright="Copyright  Aaron Friedel 2008"     
      ComVisible="false"
      CLSCompliant="true"
      Guid="3CC36F34-A5B6-4B85-8452-0CEA69A981F5"
      AssemblyVersion="$(Major).$(Minor).$(Build).$(Revision)"
      AssemblyFileVersion="$(Major).$(Minor).$(Build).$(Revision)"
      Condition="$(Revision) != '0' "/>
  </Target>

  <Target Name="Compile" DependsOnTargets="Version">
    <MSBuild Projects="$(OutputPath)\net.toodledo\net.toodledo.csproj	"
             Properties="Configuration=Release" />
	<MSBuild Projects="$(OutputPath)\GTD\GTD.csproj"
             Properties="Configuration=Release" />
  </Target>

<!--   <Target Name="Documentation" DependsOnTargets="Compile">
    <NDoc Documenter="MSDN"
          ProjectFilePath="Documentation\MSBuild.Community.Tasks.ndoc" />
    <Copy SourceFiles="doc\MSBuild Community Tasks.chm"
          DestinationFiles="Documentation\MSBuild.Community.Tasks.chm" />
    <RemoveDir Directories="doc" />
  </Target>
-->
 <Target Name="Zip" DependsOnTargets="Compile">
   <CreateItem Include="**\$(OutputPath)\**\*.*" Exclude="@(ReleaseExclude);**\*.suo"><!---->
     <Output TaskParameter="Include" ItemName="ZipFiles"/>
   </CreateItem>
    <Zip Files="@(ZipFiles)"
         ZipFileName="SharpGTD.v$(Major).$(Minor).$(Build).$(Revision).zip"
         WorkingDirectory="$(OutputPath)"/>
	
  </Target>

 <Target Name="Build" DependsOnTargets="Zip">
    <Message Text="Build Complete"/>
 </Target>
 
  
   
	<Target Name="Clean" >
        <RemoveDir Directories="$(OutputPath)" />
    </Target>
  

	
	
</Project>

